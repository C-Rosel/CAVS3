Bootstrap: docker
From: ubuntu:20.04

%labels
    Maintainer CAVS3

%post
    # Update and install required dependencies
    apt-get update && apt-get install -y \
        curl \
        wget \
        git \
        build-essential \
        python3 \
        python3-pip \
        ros-noetic-rosbridge-server \
        nodejs \
        npm

    # Install additional ROS packages
    . /opt/ros/noetic/setup.sh
    apt-get install -y \
        ros-noetic-tf2-web-republisher \
        ros-noetic-rosauth

    # Set up React app
    mkdir -p /frontend
    cd /frontend
    # Assuming React app is already in the build context
    cp -r /CAVS3/frontend/* /frontend/
    npm install
    npm install roslib

%environment
    export ROS_MASTER_URI="http://localhost:11311"
    export ROSBRIDGE_SERVER_URI="ws://localhost:9090"

%startscript
    # Start the React app
    cd /frontend
    npm run dev --host 0.0.0.0 &
    
    # Wait for server to start
    sleep 5

    # Open browser if local
    xdg-open "http://localhost:5173" || echo "Open http://localhost:5173 in your browser."
